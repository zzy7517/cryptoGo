# æ•°æ®åº“è¿ç§»æ€»ç»“ï¼šPostgreSQL â†’ SQLite

## ğŸ¯ è¿ç§»ç›®æ ‡

å°†é¡¹ç›®ä»ä¾èµ–å¤–éƒ¨ PostgreSQLï¼ˆSupabaseï¼‰è¿ç§»åˆ°æœ¬åœ° SQLiteï¼Œç®€åŒ–éƒ¨ç½²å’Œè¿ç»´ã€‚

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒä»£ç ä¿®æ”¹

#### `backend/app/utils/config.py`
- âœ… ä¿®æ”¹é»˜è®¤ `DATABASE_URL` ä¸º `sqlite:///./data/trading.db`
- âœ… æ·»åŠ æ•°æ®åº“é€‰æ‹©è¯´æ˜æ³¨é‡Š

#### `backend/app/utils/database.py`
- âœ… æ·»åŠ  SQLite å’Œ PostgreSQL è‡ªåŠ¨è¯†åˆ«é€»è¾‘
- âœ… å®ç° SQLite ç‰¹å®šé…ç½®ï¼ˆå¤–é”®çº¦æŸã€WAL æ¨¡å¼ï¼‰
- âœ… è‡ªåŠ¨åˆ›å»ºæ•°æ®ç›®å½•åŠŸèƒ½
- âœ… ä¿æŒ PostgreSQL å…¼å®¹æ€§

### 2. æ•°æ®åº“ Schema

#### `backend/schema.sqlite.sql` (æ–°å»º)
- âœ… å®Œæ•´çš„ SQLite ç‰ˆæœ¬ Schema
- âœ… è½¬æ¢ PostgreSQL ç‰¹æœ‰è¯­æ³•ï¼ˆBIGSERIAL â†’ INTEGER AUTOINCREMENTï¼‰
- âœ… è°ƒæ•´æ•°æ®ç±»å‹ï¼ˆARRAY â†’ TEXT/JSONï¼‰
- âœ… æ·»åŠ  SQLite æ€§èƒ½ä¼˜åŒ–é…ç½®

### 3. Docker é…ç½®

#### `docker/docker-compose.yml`
- âœ… æ·»åŠ  volume æŒ‚è½½ï¼š`backend/data` â†’ `/app/data`
- âœ… ä¿®æ”¹ DATABASE_URL é»˜è®¤å€¼æ”¯æŒ SQLite
- âœ… æ›´æ–°é…ç½®è¯´æ˜æ³¨é‡Š

### 4. é¡¹ç›®é…ç½®

#### `.gitignore`
- âœ… æ·»åŠ  SQLite æ•°æ®åº“æ–‡ä»¶å¿½ç•¥è§„åˆ™
  - `backend/data/*.db`
  - `backend/data/*.db-shm`
  - `backend/data/*.db-wal`

#### `backend/data/` (æ–°å»º)
- âœ… åˆ›å»ºæ•°æ®ç›®å½•
- âœ… æ·»åŠ  `.gitkeep` æ–‡ä»¶ä¿æŒç›®å½•ç»“æ„

### 5. æ–‡æ¡£æ›´æ–°

#### `README.md`
- âœ… æ›´æ–°æŠ€æœ¯æ ˆè¯´æ˜ï¼ˆSQLite ä¸ºé»˜è®¤ï¼‰
- âœ… ç§»é™¤ PostgreSQL å‰ç½®è¦æ±‚
- âœ… æ·»åŠ "æ•°æ®åº“è¯´æ˜"ç« èŠ‚
- âœ… æ›´æ–°ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹
- âœ… æ›´æ–°é¡¹ç›®ç»“æ„è¯´æ˜

#### `docker/README.md`
- âœ… æ›´æ–°ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹
- âœ… æ·»åŠ é›¶é…ç½®è¯´æ˜
- âœ… æ›´æ–°æ•…éšœæ’æŸ¥æŒ‡å—

## ğŸ“Š è¿ç§»å¯¹æ¯”

| ç‰¹æ€§ | PostgreSQL (æ—§) | SQLite (æ–°) |
|------|----------------|-------------|
| **éƒ¨ç½²å¤æ‚åº¦** | éœ€è¦å¤–éƒ¨æœåŠ¡ | é›¶é…ç½® |
| **ä¾èµ–** | Supabase/è‡ªå»º | Python å†…ç½® |
| **é…ç½®é¡¹** | å¿…éœ€ DATABASE_URL | å¯é€‰ï¼ˆæœ‰é»˜è®¤å€¼ï¼‰|
| **æ•°æ®æŒä¹…åŒ–** | è¿œç¨‹å­˜å‚¨ | æœ¬åœ°æ–‡ä»¶ |
| **å¤‡ä»½** | ä¾èµ–æœåŠ¡å•† | å¤åˆ¶æ–‡ä»¶å³å¯ |
| **æˆæœ¬** | éœ€ä»˜è´¹æœåŠ¡ | å®Œå…¨å…è´¹ |
| **æ€§èƒ½** | ç½‘ç»œå»¶è¿Ÿ | æœ¬åœ°è®¿é—® |
| **é€‚ç”¨åœºæ™¯** | é«˜å¹¶å‘/å¤šç”¨æˆ· | ä¸ªäºº/å°å›¢é˜Ÿ |

## ğŸš€ ä½¿ç”¨æ–¹å¼

### é»˜è®¤ SQLite æ¨¡å¼ï¼ˆæ¨èï¼‰

**æ— éœ€é…ç½®ä»»ä½•æ•°æ®åº“**ï¼ç›´æ¥è¿è¡Œï¼š

```bash
cd backend
uvicorn app.main:app --reload --host 0.0.0.0 --port 9527
```

æ•°æ®åº“æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ›å»ºåœ¨ `backend/data/trading.db`

### åˆ‡æ¢åˆ° PostgreSQLï¼ˆå¯é€‰ï¼‰

å¦‚éœ€ä½¿ç”¨ PostgreSQLï¼Œåªéœ€è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
export DATABASE_URL="postgresql://user:pass@host:5432/dbname"
```

æˆ–åœ¨ `.env` æ–‡ä»¶ä¸­ï¼š
```env
DATABASE_URL=postgresql://user:pass@host:5432/dbname
```

**ä»£ç æ— éœ€ä»»ä½•ä¿®æ”¹ï¼**

## ğŸ”„ å…¼å®¹æ€§

### âœ… å®Œå…¨å…¼å®¹
- æ‰€æœ‰ç°æœ‰ API æ¥å£
- æ‰€æœ‰ ORM æ¨¡å‹
- æ‰€æœ‰ Repository æ–¹æ³•
- å‰ç«¯ä»£ç æ— éœ€ä¿®æ”¹

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°ç»„ç±»å‹**ï¼šSQLite ä¸­ä½¿ç”¨ JSON æ–‡æœ¬å­˜å‚¨ï¼ˆè‡ªåŠ¨å¤„ç†ï¼‰
2. **æ—¶é—´é—´éš”**ï¼šSQLite ä¸­ä½¿ç”¨æ–‡æœ¬å­˜å‚¨ï¼ˆè‡ªåŠ¨å¤„ç†ï¼‰
3. **å¤–é”®çº¦æŸ**ï¼šéœ€è¦æ‰‹åŠ¨å¯ç”¨ï¼ˆå·²åœ¨ä»£ç ä¸­é…ç½®ï¼‰

## ğŸ“ æ•°æ®è¿ç§»ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰

å¦‚æœå·²æœ‰ PostgreSQL æ•°æ®éœ€è¦è¿ç§»ï¼š

```bash
# 1. ä» PostgreSQL å¯¼å‡ºæ•°æ®ï¼ˆç¤ºä¾‹ï¼‰
pg_dump -h host -U user -d dbname --data-only > data.sql

# 2. è½¬æ¢ä¸º SQLite æ ¼å¼ï¼ˆéœ€æ‰‹åŠ¨è°ƒæ•´ï¼‰
# ä¿®æ”¹ BIGSERIALã€ARRAY ç­‰ä¸å…¼å®¹çš„ç±»å‹

# 3. å¯¼å…¥åˆ° SQLite
sqlite3 backend/data/trading.db < data_converted.sql
```

## ğŸ‰ ä¼˜åŠ¿æ€»ç»“

### å¼€å‘ä½“éªŒ
- âœ… æœ¬åœ°å¼€å‘æ— éœ€ç½‘ç»œ
- âœ… æ•°æ®åº“æ–‡ä»¶å¯éšæ„å¤åˆ¶
- âœ… å¿«é€ŸåŸå‹å¼€å‘

### éƒ¨ç½²è¿ç»´
- âœ… Docker é•œåƒæ›´ç®€å•
- âœ… æ— éœ€é…ç½®å¤–éƒ¨æœåŠ¡
- âœ… å¤‡ä»½å°±æ˜¯å¤åˆ¶æ–‡ä»¶

### æˆæœ¬
- âœ… é›¶æˆæœ¬è¿è¡Œ
- âœ… æ— éœ€ä»˜è´¹æ•°æ®åº“æœåŠ¡
- âœ… é™ä½æœåŠ¡å™¨è¦æ±‚

## ğŸ”® æœªæ¥æ‰©å±•

å½“éœ€è¦å‡çº§åˆ° PostgreSQL æ—¶ï¼ˆå¤šç”¨æˆ·/é«˜å¹¶å‘åœºæ™¯ï¼‰ï¼š
1. ä¿®æ”¹ç¯å¢ƒå˜é‡ `DATABASE_URL`
2. ä»£ç æ— éœ€ä»»ä½•æ”¹åŠ¨
3. å¹³æ»‘è¿ç§»

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- [README.md](./README.md) - å®Œæ•´ä½¿ç”¨æŒ‡å—
- [docker/README.md](./docker/README.md) - Docker éƒ¨ç½²æŒ‡å—
- [backend/schema.sqlite.sql](./backend/schema.sqlite.sql) - æ•°æ®åº“ç»“æ„å‚è€ƒ
